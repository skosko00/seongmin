SELECT EMP_NAME AS "이름",
EXTRACT(YEAR FROM SYSDATE)-('19'||SUBSTR(EMP_NO,1,2)) AS "나이",
NVL(DEPT_TITLE,'부서없음') AS "부서명",
JOB_NAME AS "직책명"
FROM EMPLOYEE
LEFT JOIN DEPARTMENT ON (DEPT_CODE = DEPT_ID)
JOIN JOB ON (JOB.JOB_CODE = EMPLOYEE.JOB_CODE)
ORDER BY 2 DESC;

## 중간 점검 실습 문제 ##
--1. 2020년 12월 25일이 무슨 요일인지 조회하시오.
SELECT TO_CHAR(TO_DATE(20201225, 'YYYY/MM/DD'),'DAY')
FROM DUAL;


--2. 주민번호가 1970년대 생이면서 성별이 여자이고, 
성이 전씨인 직원들의 사원명, 주민번호, 부서명, 직급명을 조회하시오.
SELECT EMP_NAME AS "사원명",
EMP_NO AS "주민번호",
DEPT_TITLE AS "부서",
JOB_NAME AS "직급"
FROM EMPLOYEE
JOIN DEPARTMENT ON (DEPT_CODE=DEPT_ID)
JOIN JOB USING(JOB_CODE)
WHERE SUBSTR(EMP_NO,1,2) BETWEEN 70 AND 79
AND SUBSTR(EMP_NO,8,1)=2
AND EMP_NAME LIKE '전%';


--3. 이름에 '형'자가 들어가는 직원들의 
사번, 사원명, 부서명을 조회하시오.
SELECT EMP_ID AS "사원번호",
EMP_NAME AS "사원명",
DEPT_TITLE AS "부서"
FROM EMPLOYEE
JOIN DEPARTMENT ON (DEPT_CODE=DEPT_ID)
WHERE EMP_NAME LIKE '%형%';


--4. 해외영업부에 근무하는 
사원명, 직급명, 부서코드, 부서명을 조회하시오.
SELECT EMP_NAME AS "사원명",
EMPLOYEE.JOB_CODE AS "직급",
JOB_NAME AS "부서코드",
DEPT_TITLE AS "부서명"
FROM EMPLOYEE, DEPARTMENT, JOB
WHERE DEPT_ID = DEPT_CODE AND
EMPLOYEE.JOB_CODE = JOB.JOB_CODE AND
DEPT_TITLE LIKE '해외영업%';


--5. 보너스포인트를 받는 직원들의 
SELECT EMP_NAME AS "사원명",
BONUS AS "보너스 포인트",
DEPT_TITLE AS "부서명",
LOCAL_NAME AS "근무지역"
FROM EMPLOYEE E, DEPARTMENT D, LOCATION L
WHERE E.DEPT_CODE = D.DEPT_ID(+) AND
D.LOCATION_ID = LOCAL_CODE(+) AND
BONUS IS NOT NULL;


--6. 부서코드가 D2인 직원들의 
SELECT EMP_NAME AS "사원명",
JOB_NAME AS "직급",
DEPT_TITLE AS "부서",
LOCAL_NAME AS "근무지역"
FROM EMPLOYEE E, JOB J, DEPARTMENT D, LOCATION L
WHERE E.DEPT_CODE = D.DEPT_ID AND
E.JOB_CODE = J.JOB_CODE AND
D.LOCATION_ID = LOCAL_CODE AND
DEPT_CODE = 'D2';


--7. 급여등급테이블의 최대급여(MAX_SAL)에서 -50만원보다 많이 받는 직원들의 
사원명, 직급명, 급여, 연봉을 조회하시오.
-- (사원테이블과 급여등급테이블을 SAL_LEVEL컬럼기준으로 조인할 것)
SELECT EMP_NAME AS "사원명",
JOB_NAME AS "직급명",
SALARY AS "급여",
SALARY*12 AS "연봉"
FROM EMPLOYEE
JOIN JOB USING (JOB_CODE)
JOIN SAL_GRADE USING(SAL_LEVEL)
WHERE SALARY>MAX_SAL-500000;


--8. 한국(KO)과 일본(JP)에 근무하는 직원들의 
사원명, 부서명, 지역명, 국가명을 조회하시오.
SELECT EMP_NAME AS "사원",
DEPT_TITLE AS "부서",
LOCAL_NAME AS "지역",
NATIONAL_NAME AS "국가"
FROM EMPLOYEE 
JOIN DEPARTMENT ON (DEPT_CODE = DEPT_ID)
JOIN LOCATION ON (LOCATION_ID = LOCAL_CODE)
JOIN NATIONAL USING(NATIONAL_CODE)
WHERE NATIONAL_CODE IN ('KO','JP');


--9. 같은 부서에 근무하는 직원들의 사원명, 부서명, 동료이름을 
조회하시오. (self join 사용)
SELECT E.EMP_NAME AS "사원",
DEPT_TITLE AS "부서",
E2.EMP_NAME AS "동료"
FROM EMPLOYEE E, EMPLOYEE E2, DEPARTMENT D
WHERE E.DEPT_CODE = D.DEPT_ID AND
E.DEPT_CODE = E2.DEPT_CODE
ORDER BY 1;


--10. 보너스포인트가 없는 직원들 중에서 직급이 차장과 
사원인 직원들의 사원명, 직급명, 급여를 조회하시오. 
단, join과 IN 사용할 것
SELECT EMP_NAME AS "사원",
JOB_NAME AS "직급",
SALARY AS "급여"
FROM EMPLOYEE
JOIN JOB USING(JOB_CODE)
WHERE JOB_NAME IN ('차장','사원') AND
BONUS IS NULL
ORDER BY 2;


--11. 재직중인 직원과 퇴사한 직원의 수를 조회하시오.
SELECT DECODE(ENT_YN,'Y','퇴사','재직') AS "재직여부",
COUNT(*) AS "인원수"
FROM EMPLOYEE
GROUP BY ENT_YN;


