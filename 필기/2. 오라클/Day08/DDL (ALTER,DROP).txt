

@ ALTER
-> 테이블에 정의된 내용을 수정 할 때 사용하는 데이터 정의어
-> 컬럼의 추가, 삭제, 제약 조건의 추가/삭제, 컬럼의 자료형 변경,
DEFAULT값 변경(옵션), 테이블명/컬럼명/제약조건의 이름 변경 등을 할 수 있음



## 연습용 TABLE을 생성


CREATE TABLE MEMBER_TEST
(
	USER_NO number primary key,
	USER_ID VARCHAR2(20),
	USER_PWD CHAR(20)
);

SELECT * FROM MEMBER_TEST;


-- 이미 생성된 테이블에 새로운 컬럼 (유저 이름 : user_name varchar2(20))
ALTER TABLE MEMBER_TEST ADD(USER_NAME VARCHAR2(20));

-- 확인
SELECT * FROM MEMBER_TEST;
-- 구조 확인
DESC MEMBER_TEST;

-- 새로운 컬럼 추가 및 DEFAULT 값 설정
-- (나이 : USER_AGE NUMBER   / 기본값 : 0 )
ALTER TABLE MEMBER_TEST ADD(USER_AGE NUMBER DEFAULT 0);

-- 구조 확인
DESC MEMBER_TEST;

-- 데이터 삽입
INSERT INTO MEMBER_TEST
VALUES (1,'user11','1111','홍길동',DEFAULT);

-- 데이터 확인
SELECT * FROM MEMBER_TEST;

-- 제약조건이 없으면 중복된 ID가 저장됨
INSERT INTO MEMBER_TEST
VALUES (2,'user11','2222','김말똥',DEFAULT);

-- 테이블의 설정된 제약 조건 확인
SELECT TABLE_NAME, COLUMN_NAME, CONSTRAINT_NAME 
FROM USER_CONS_COLUMNS
WHERE TABLE_NAME='MEMBER_TEST'
UNION
SELECT TABLE_NAME,CONSTRAINT_NAME, CONSTRAINT_TYPE 
FROM USER_CONSTRAINTS
WHERE TABLE_NAME='MEMBER_TEST'
ORDER BY 3 DESC;


-- 제약 조건 추가
-- 형식
-- ALTER TABLE 테이블명 ADD CONSTRAINT 제약조건이름 제약조건(컬럼)
ALTER TABLE MEMBER_TEST
ADD CONSTRAINT MEMBER_ID_UNQ UNIQUE(USER_ID);


-- NOT NULL 제약 조건을 추가할때에는 ADD가 아닌 MODIFY로 해야함
ALTER TABLE MEMBER_TEST
MODIFY USER_PWD CONSTRAINT MEMBER_PWD_NN NOT NULL;


@ 컬럼명 수정
-> 이미 만들어진 테이블의 컬럼명을 수정 할 수 있음

-- 컬럼명 수정
-- USER_PWD -> PASSWORD

ALTER TABLE MEMBER_TEST
RENAME COLUMN USER_PWD TO PASSWORD;

SELECT * FROM MEMBER_TEST;

-- 컬럼의 데이터 타입 수정
-- USER_NAME VARCHAR2(20) -> CHAR(30)

ALTER TABLE MEMBER_TEST
MODIFY USER_NAME CHAR(30);
DESC MEMBER_TEST;

-- DEFAULT 값 수정
-- USER_AGE의 DEFAULT 값 수정 (0 -> 99)

ALTER TABLE MEMBER_TEST
MODIFY USER_AGE DEFAULT 99;


@ 컬럼 삭제
-> 해당 테이블에 생성되어 있는 컬럼을 삭제 할 수 있음

-- 컬럼 삭제
-- USER_AGE 컬럼 삭제

ALTER TABLE MEMBER_TEST
DROP COLUMN USER_AGE;
SELECT * FROM MEMBER_TEST;

-- 간단 예제
-- MEMBER_TEST01 테이블의 USER_ID를
-- MEMBER_FOREIGN 테이블에서 참조(외래키 설정)하고 있을 때
-- MEMBER_TEST01 테이블에서 USER_ID를 삭제 하고 싶을 때
SELECT * FROM MEMBER_TEST01;
SELECT * FROM MEMBER_FOREIGN;

-- 해당 컬럼을 삭제 할 때 제약조건이 연결되어 있다면
-- 해당 제약조건도 모두 삭제하면서 컬럼을 지우는 SQL
ALTER TABLE MEMBER_TEST01
DROP COLUMN USER_ID CASCADE CONSTRAINTS;
SELECT * FROM MEMBER_TEST01;
-- 제약 조건 삭제
-- 설정되어 있는 제약조건을 삭제 할 수 있음
-- 테이블의 설정된 제약조건 확인
SELECT TABLE_NAME, COLUMN_NAME, CONSTRAINT_NAME
FROM USER_CONS_COLUMNS
WHERE TABLE_NAME='MEMBER_TEST'
UNION
SELECT TABLE_NAME,CONSTRAINT_NAME,CONSTRAINT_TYPE 
FROM USER_CONSTRAINTS
WHERE TABLE_NAME='MEMBER_TEST'
ORDER BY 3 DESC;

-- MEMBER_TEST 테이블에 설정된 UNIQUE 제약 조건 삭제
ALTER TABLE MEMBER_TEST
DROP CONSTRAINT MEMBER_ID_UNQ;

-- 제약조건 이름 변경
-- 설정되어 있는 제약조건의 이름을 변경 할 수 있음

ALTER TABLE MEMBER_TEST
RENAME CONSTRAINT SYS_C007117 TO MEMBER_NUM_PK;

-- 테이블 이름 변경
-- 생성된 테이블이 이름 변경이 가능함
ALTER TABLE MEMBER_TEST
RENAME TO MEMBER_TEST_TBL;

SELECT * FROM MEMBER_TEST_TBL;

-- 테이블 삭제
-- DROP 명령어를 통해 테이블 삭제가 가능함
DROP TABLE MEMBER_TEST_TBL;
-- 혹은 연결된 제약조건을 모두 함께 삭제할 수도 있음
DROP TABLE MEMBER_TEST_TBL CASCADE CONSTRAINTS;